const ct=`
`,B="	",W="=",v='"',U=" ",k="[",j="]",I="/",Y="\\",Q=t=>typeof t=="object"&&!!t.tag,mt=t=>typeof t=="string",Ot=(t,e,n)=>Object.keys(t).reduce(e,n),xt=t=>Q(t)?t.content.reduce((e,n)=>e+xt(n),0):mt(t)?t.length:0,Jt=(t,e)=>{t.content.push(e)},pt=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/(javascript|data|vbscript):/gi,"$1%3A"),Ct=(t,e)=>{const n=typeof e,s={boolean:()=>e?`${t}`:"",number:()=>`${t}="${e}"`,string:()=>`${t}="${pt(e)}"`,object:()=>`${t}="${pt(JSON.stringify(e))}"`};return s[n]?s[n]():""},J=t=>t==null?"":Ot(t,(e,n)=>[...e,Ct(n,t[n])],[""]).join(" "),X=t=>Ot(t,(e,n)=>t[n]===n?t[n]:null,null),Xt=(t,e)=>{const n=X(e);if(n){const s=Ct(t,n),i={...e};delete i[n];const u=J(i);return`${s}${u}`}return`${t}${J(e)}`};class G{attr(e,n){return typeof n<"u"&&(this.attrs[e]=n),this.attrs[e]}append(e){return Jt(this,e)}get length(){return xt(this)}toTagStart({openTag:e=k,closeTag:n=j}={}){const s=Xt(this.tag,this.attrs);return`${e}${s}${n}`}toTagEnd({openTag:e=k,closeTag:n=j}={}){return`${e}${I}${this.tag}${n}`}toTagNode(){return new G(this.tag.toLowerCase(),this.attrs,this.content)}toString({openTag:e=k,closeTag:n=j}={}){const s=this.content.length===0,i=this.content.reduce((c,m)=>c+m.toString({openTag:e,closeTag:n}),""),u=this.toTagStart({openTag:e,closeTag:n});return s?u:`${u}${i}${this.toTagEnd({openTag:e,closeTag:n})}`}constructor(e,n,s){this.tag=e,this.attrs=n,this.content=Array.isArray(s)?s:[s]}}G.create=(t,e={},n=[])=>new G(t,e,n);G.isOf=(t,e)=>t.tag===e;const L="type",at="value",Rt="row",wt="line",Wt=1,Gt=2,$t=3,Pt=4,Mt=5,Dt=6,tt=t=>t&&typeof t[at]<"u"?t[at]:"",Zt=t=>t&&t[wt]||0,te=t=>t&&t[Rt]||0,ee=t=>t&&typeof t[L]<"u"?t[L]===Mt||t[L]===Dt||t[L]===Wt:!1,ne=t=>t&&typeof t[L]<"u"?t[L]===Gt:!1,lt=t=>tt(t).charCodeAt(0)===I.charCodeAt(0),se=t=>!lt(t),re=t=>t&&typeof t[L]<"u"?t[L]===$t:!1,oe=t=>t&&typeof t[L]<"u"?t[L]===Pt:!1,ie=t=>{const e=tt(t);return lt(t)?e.slice(1):e},ce=t=>{let e=k;return e+=tt(t),e+=j,e};class ae{isEmpty(){return isNaN(this[L])}isText(){return ee(this)}isTag(){return ne(this)}isAttrName(){return re(this)}isAttrValue(){return oe(this)}isStart(){return se(this)}isEnd(){return lt(this)}getName(){return ie(this)}getValue(){return tt(this)}getLine(){return Zt(this)}getColumn(){return te(this)}toString(){return ce(this)}constructor(e,n,s,i){this[L]=Number(e),this[at]=String(n),this[wt]=Number(s),this[Rt]=Number(i)}}const V=Wt,dt=Gt,ue=$t,_t=Pt,le=Mt,Te=Dt;function fe(t,e){const n={pos:0,len:t.length},s=T=>{const{pos:h}=n,g=t.indexOf(T,h);return g>=0?t.substring(h,g):""},i=T=>t.indexOf(T,n.pos)>=0,u=()=>n.len>n.pos,c=()=>n.pos===n.len,m=(T=1,h)=>{n.pos+=T,e&&e.onSkip&&!h&&e.onSkip()},f=()=>t.substring(n.pos),d=(T=0)=>t.substring(n.pos,n.pos+T),_=()=>t[n.pos],C=()=>{const T=n.pos-1;return typeof t[T]<"u"?t[T]:null},R=()=>{const T=n.pos+1;return T<=t.length-1?t[T]:null},O=(T,h)=>{let g=0;if(u())for(g=n.pos;u()&&T(_());)m(1,h);return t.substring(g,n.pos)};this.skip=m,this.hasNext=u,this.getCurr=_,this.getRest=f,this.getNext=R,this.getPrev=C,this.isLast=c,this.includes=i,this.grabWhile=O,this.grabN=d,this.substrUntilChar=s}const St=(t,e)=>new fe(t,e),ge=(t,e)=>{for(;t.charAt(0)===e;)t=t.substring(1);for(;t.charAt(t.length-1)===e;)t=t.substring(0,t.length-1);return t},Ae=t=>t.replace(Y+v,v);function he(t=[]){const e=t,n=()=>Array.isArray(e)&&e.length>0&&typeof e[e.length-1]<"u"?e[e.length-1]:null,s=()=>e.length?e.pop():!1,i=c=>e.push(c),u=()=>e;this.push=i,this.toArray=u,this.getLast=n,this.flushLast=s}const q=(t=[])=>new he(t),Ee="!",pe=(t,e,n=0,s=0)=>new ae(t,e,n,s);function de(t,e={}){let f=0,d=0,_=-1,C=0,R=0,O="";const T=new Array(Math.floor(t.length)),h=e.openTag||k,g=e.closeTag||j,nt=!!e.enableEscapeTags,st=e.contextFreeTags||[],rt=e.onToken||(()=>{}),ot=[g,h,v,Y,U,B,W,ct,Ee],it=[h,U,B,ct],r=[U,B],l=[W,U,B],p=o=>ot.indexOf(o)>=0,P=o=>o===ct,N=o=>r.indexOf(o)>=0,Tt=o=>it.indexOf(o)===-1,It=o=>l.indexOf(o)>=0,kt=o=>o===h||o===g||o===Y,ft=o=>o===Y,gt=()=>{d++},At=o=>Ae(ge(o,v)),ht=(o,A)=>{O!==""&&A&&(O=""),O===""&&st.includes(o)&&(O=o)},a=St(t,{onSkip:gt});function S(o,A){const E=pe(o,A,f,d);rt(E),_+=1,T[_]=E}function jt(o,A){if(R===1){const b=H=>!(H===W||N(H)),$=o.grabWhile(b),M=o.isLast(),D=o.getCurr()!==W;return o.skip(),M||D?S(_t,At($)):S(ue,$),M?0:D?1:2}if(R===2){let b=!1;const $=D=>{const H=D===v,Ht=o.getPrev(),Et=o.getNext(),Bt=Ht===Y,qt=Et===W,zt=N(D),Qt=N(Et);return b&&It(D)?!0:H&&!Bt&&(b=!b,!b&&!(qt||Qt))?!1:A?!0:zt===!1},M=o.grabWhile($);return o.skip(),S(_t,At(M)),o.isLast()?0:1}const E=b=>!(b===W||N(b)||o.isLast()),y=o.grabWhile(E);return S(dt,y),ht(y),o.skip(),A?2:o.includes(W)?1:2}function Kt(){const o=a.getCurr(),A=a.getNext();a.skip();const E=a.substrUntilChar(g),y=E.length===0||E.indexOf(h)>=0;if(p(A)||y||a.isLast())return S(V,o),0;const w=E.indexOf(W)===-1,b=E[0]===I;if(w||b){const $=a.grabWhile(M=>M!==g);return a.skip(),S(dt,$),ht($,b),0}return 2}function Ut(){const A=a.grabWhile(w=>w!==g,!0),E=St(A,{onSkip:gt}),y=E.includes(U);for(R=0;E.hasNext();)R=jt(E,!y);return a.skip(),0}function Ft(){if(P(a.getCurr()))return S(Te,a.getCurr()),a.skip(),d=0,f++,0;if(N(a.getCurr())){const A=a.grabWhile(N);return S(le,A),0}if(a.getCurr()===h){if(O){const A=h.length+I.length+O.length,E=`${h}${I}${O}`;if(a.grabN(A)===E)return 1}else if(a.includes(g))return 1;return S(V,a.getCurr()),a.skip(),0}if(nt){if(ft(a.getCurr())){const y=a.getCurr(),w=a.getNext();return a.skip(),kt(w)?(a.skip(),S(V,w),0):(S(V,y),0)}const A=y=>Tt(y)&&!ft(y),E=a.grabWhile(A);return S(V,E),0}const o=a.grabWhile(Tt);return S(V,o),0}function Yt(){for(C=0;a.hasNext();)switch(C){case 1:C=Kt();break;case 2:C=Ut();break;case 0:default:C=Ft();break}return T.length=_+1,T}function vt(o){const A=h+I+o.getValue();return t.indexOf(A)>-1}return{tokenize:Yt,isTokenNested:vt}}const _e=(t,e={})=>{const n=e,s=n.openTag||k,i=n.closeTag||j;let u=null;const c=q(),m=q(),f=q(),d=q(),_=new Set,C=r=>{const l=r.getValue();return!_.has(l)&&u.isTokenNested&&u.isTokenNested(r)?(_.add(l),!0):_.has(l)},R=r=>!!_.has(r),O=r=>n.onlyAllowTags&&n.onlyAllowTags.length?n.onlyAllowTags.indexOf(r)>=0:!0,T=()=>{f.flushLast()&&d.flushLast()},h=()=>{const r=m.getLast();return r&&Array.isArray(r.content)?r.content:c.toArray()},g=r=>{const l=h();Array.isArray(l)&&(Q(r)?O(r.tag)?l.push(r.toTagNode()):(l.push(r.toTagStart({openTag:s,closeTag:i})),r.content.length&&(r.content.forEach(p=>{l.push(p)}),l.push(r.toTagEnd({openTag:s,closeTag:i})))):l.push(r))},nt=r=>{T();const l=G.create(r.getValue()),p=C(r);f.push(l),p?m.push(l):g(l)},st=r=>{T();const l=m.flushLast();if(l)g(l);else if(typeof n.onError=="function"){const p=r.getValue(),P=r.getLine(),N=r.getColumn();n.onError({message:`Inconsistent tag '${p}' on line ${P} and column ${N}`,tagName:p,lineNumber:P,columnNumber:N})}},rt=r=>{r.isStart()&&nt(r),r.isEnd()&&st(r)},ot=r=>{const l=f.getLast(),p=r.getValue(),P=R(r);if(l)if(r.isAttrName())d.push(p),l.attr(d.getLast(),"");else if(r.isAttrValue()){const N=d.getLast();N?(l.attr(N,p),d.flushLast()):l.attr(p,p)}else r.isText()?P?l.append(p):g(p):r.isTag()&&g(r.toString());else r.isText()?g(p):r.isTag()&&g(r.toString())},it=r=>{r.isTag()?rt(r):ot(r)};return u=(e.createTokenizer?e.createTokenizer:de)(t,{onToken:it,openTag:s,closeTag:i,onlyAllowTags:n.onlyAllowTags,contextFreeTags:n.contextFreeTags,enableEscapeTags:n.enableEscapeTags}),u.tokenize(),c.toArray()},ut=t=>typeof t=="object",Se=t=>typeof t=="boolean";function K(t,e){const n=t;if(Array.isArray(n))for(let s=0;s<n.length;s++)n[s]=K(e(n[s]),e);else n&&ut(n)&&n.content&&K(n.content,e);return n}function Z(t,e){return typeof t!=typeof e?!1:!ut(t)||t===null?t===e:Array.isArray(t)?t.every(n=>[].some.call(e,s=>Z(n,s))):Object.keys(t).every(n=>{const s=e[n],i=t[n];return ut(i)&&i!==null&&s!==null?Z(i,s):Se(i)?i!==(s===null):s===i})}function Nt(t,e){return Array.isArray(t)?K(this,n=>{for(let s=0;s<t.length;s++)if(Z(t[s],n))return e(n);return n}):K(this,n=>Z(t,n)?e(n):n)}function Ne(t){return K(this,t)}function ye(t){const e=typeof t=="function"?[t]:t||[];let n={skipParse:!1};return{process(s,i){n=i||{};const u=n.parser||_e,c=n.render,m=n.data||null;if(typeof u!="function")throw new Error('"parser" is not a function, please pass to "process(input, { parser })" right function');let f=n.skipParse?s||[]:u(s,n);const d=f;return f.messages=[],f.options=n,f.walk=Ne,f.match=Nt,e.forEach(_=>{f=_(f,{parse:u,render:c,iterate:K,match:Nt,data:m})||f}),{get html(){if(typeof c!="function")throw new Error('"render" function not defined, please pass to "process(input, { render })"');return c(f,f.options)},tree:f,raw:d,messages:f.messages}}}}const be="/>",Le="</",yt="<",bt=">",me=(t,{stripTags:e=!1})=>{if(!t)return"";const n=typeof t;return n==="string"||n==="number"?t:n==="object"?e===!0?z(t.content,{stripTags:e}):t.content===null?[yt,t.tag,J(t.attrs),be].join(""):[yt,t.tag,J(t.attrs),bt,z(t.content),Le,t.tag,bt].join(""):Array.isArray(t)?z(t,{stripTags:e}):""},z=(t,{stripTags:e=!1}={})=>[].concat(t).reduce((n,s)=>n+me(s,{stripTags:e}),""),Oe=(t,e,n)=>ye(e).process(t,{...n,render:z}).html,xe=t=>typeof t=="object"&&!!t.tag;function Ce(t,e,n,s){e.walk(i=>xe(i)&&t[i.tag]?t[i.tag](i,n,s):i)}function Vt(t,e=Ce){const n=(s={})=>{n.options=Object.assign(n.options||{},s);const i=(u,c)=>e(t,u,c,n.options);return i.options=n.options,i};return n.extend=s=>Vt(s(t,n.options),e),n}const Re=(t,e)=>t[0]===e,Lt={color:t=>`color:${t};`,size:t=>`font-size:${t};`},we=t=>Object.keys(t).reduce((e,n)=>Lt[n]?e.concat(Lt[n](t[n])):e,[]).join(" "),We=t=>{let e=0;const n=[],s=()=>G.create("li"),i=c=>{n[e]=n[e]||c},u=c=>{n[e]&&n[e].content?n[e].content=n[e].content.concat(c):n[e]=n[e].concat(c)};return t.forEach(c=>{mt(c)&&Re(c,"*")?(n[e]&&e++,i(s()),u(c.substr(1))):Q(c)&&G.isOf(c,"*")?(n[e]&&e++,i(s())):Q(n[e])?n[e]?u(c):i(c):(e++,i(c))}),[].concat(n)},Ge=(t,e)=>X(t.attrs)?X(t.attrs):e(t.content),x=(t,e,n)=>({tag:t,attrs:e,content:n}),F=t=>({style:t}),$e={b:t=>x("span",F("font-weight: bold;"),t.content),i:t=>x("span",F("font-style: italic;"),t.content),u:t=>x("span",F("text-decoration: underline;"),t.content),s:t=>x("span",F("text-decoration: line-through;"),t.content),url:(t,{render:e},n)=>x("a",{href:Ge(t,e)},t.content),img:(t,{render:e})=>x("img",{src:e(t.content)},null),quote:t=>x("blockquote",{},[x("p",{},t.content)]),code:t=>x("pre",{},t.content),style:t=>x("span",F(we(t.attrs)),t.content),list:t=>{const e=X(t.attrs);return x(e?"ol":"ul",e?{type:e}:{},We(t.content))}},Pe=Vt($e),et=document.querySelector("bbcode"),Me=et.innerHTML,De=Oe(Me,Pe());et.innerHTML=De;const Ve=et.querySelectorAll("img");Ve.forEach(t=>{t.classList.add("img"),t.style.width="100%",t.style.marginBottom="5px"});const Ie=et.querySelectorAll("img"),ke=[...Ie].slice(0,3);ke.forEach(t=>{t.style.width="25vw"});
